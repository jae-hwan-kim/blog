---
title: "[DOCS] socketIO ê³µì‹ë¬¸ì„œ (26)"
categories:
    - socket
tags:
    - socketIO

last_modified_at: 2023-06-23T18:10:00
---

[Rooms](https://socket.io/docs/v4/rooms/) í˜ì´ì§€ í•´ì„

# 1. Rooms

Room ì€ ì†Œì¼“ì´ `join` í•˜ê±°ë‚˜ `leave` í•  ìˆ˜ ìˆëŠ” ì„ì˜ì˜ ì±„ë„ì…ë‹ˆë‹¤. ì¼ë¶€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img src="https://github.com/Gaepo-transcendance-fighters/ft_memo/assets/85930183/a48fea11-0c05-4601-909e-f6cdaad2fad0" width="90%">

â˜ğŸ» Rooms ì€ ì„œë²„ ì „ìš© ê°œë…ì…ë‹ˆë‹¤(ì¦‰, í´ë¼ì´ì–¸íŠ¸ëŠ” ìì‹ ì´ ì°¸ì—¬í•œ ê°ì‹¤ ëª©ë¡ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ìŒ).

<br>

---

## 1-1. Rooms

joinì„ í˜¸ì¶œí•˜ì—¬ ì†Œì¼“ì„ ì§€ì •ëœ ì±„ë„ì— êµ¬ë…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
io.on("connection", (socket) => {
    socket.join("some room");
});
```

ê·¸ëŸ° ë‹¤ìŒ broadcasting ë˜ëŠ” emit í•  ë•Œ `to` ë˜ëŠ” `in`(ë‘˜ ë‹¤ ë™ì¼)ì„ ì‚¬ìš©í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

```ts
io.to("some room").emit("some event");
```

ì—¬ëŸ¬ ë°©ì— ë™ì‹œì— ì†¡ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
io.to("room1").to("room2").to("room3").emit("some event");
```

ì´ ê²½ìš° [union](<https://en.wikipedia.org/wiki/Union_(set_theory)>)ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. ì ì–´ë„ í•˜ë‚˜ì˜ ë°©ì— ìˆëŠ” ëª¨ë“  ì†Œì¼“ì€ ì´ë²¤íŠ¸ë¥¼ **í•œ ë²ˆ**ì”© ë°›ê²Œ ë©ë‹ˆë‹¤(ì†Œì¼“ì´ ë‘ ê°œ ì´ìƒì˜ ë°©ì— ìˆë”ë¼ë„).

ì§€ì •ëœ ì†Œì¼“ì—ì„œ ë°©ìœ¼ë¡œ broadcast í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```ts
io.on("connection", (socket) => {
    socket.to("some room").emit("some event");
});
```

ì´ ê²½ìš° ë°œì‹ ìë¥¼ ì œì™¸í•œ ë°©ì˜ ëª¨ë“  ì†Œì¼“ì— ì´ë²¤íŠ¸ê°€ ì „ì†¡ë©ë‹ˆë‹¤.

<img src="https://github.com/Gaepo-transcendance-fighters/ft_memo/assets/85930183/79b34535-deba-417f-a9b1-a3c310faae22" width="90%">

ì±„ë„ì—ì„œ íƒˆí‡´í•˜ë ¤ë©´ `join` ê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ `leave` ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

<br>

---

## 1-2. Sample use cases

-   ì‚¬ìš©ìì˜ ê° ë””ë°”ì´ìŠ¤/íƒ­ì— ë°ì´í„° broadcast

    ```ts
    io.on("connection", async (socket) => {
        const userId = await fetchUserId(socket);

        socket.join(userId);

        // and then later
        io.to(userId).emit("hi");
    });
    ```

-   íŠ¹ì • ì—”í„°í‹°ì— ëŒ€í•œ ì•Œë¦¼ ë³´ë‚´ê¸°

    ```ts
    io.on("connection", async (socket) => {
        const projects = await fetchProjects(socket);

        projects.forEach((project) => socket.join("project:" + project.id));

        // and then later
        io.to("project:4321").emit("project updated");
    });
    ```

<br>

---

## 1-3. Disconnection

ì—°ê²°ì´ ëŠì–´ì§€ë©´ ì†Œì¼“ì€ ì†Œì†ë˜ì–´ ìˆë˜ ëª¨ë“  ì±„ë„ì—ì„œ ìë™ìœ¼ë¡œ ë¹ ì ¸ë‚˜ê°€ë¯€ë¡œ ì‚¬ìš©ìê°€ íŠ¹ë³„íˆ ë¶„ë¦¬í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

```ts
io.on("connection", (socket) => {
    socket.on("disconnecting", () => {
        console.log(socket.rooms); // the Set contains at least the socket ID
    });

    socket.on("disconnect", () => {
        // socket.rooms.size === 0
    });
});
```

<br>

---

## 1-4. With multiple Socket.IO servers

[Global Broadcasting](https://socket.io/docs/v4/broadcasting-events/#with-multiple-socketio-servers) ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ rooms ë¡œ broadcasting í•˜ëŠ” ê²ƒë„ ì—¬ëŸ¬ ê°œì˜ Socket.IO ì„œë²„ì—ì„œ ì‘ë™í•©ë‹ˆë‹¤.

ê¸°ë³¸ [Adapter](https://socket.io/docs/v4/glossary/#adapter) ë¥¼ Redis ì–´ëŒ‘í„°ë¡œ êµì²´í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://socket.io/docs/v4/redis-adapter/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

<img src="https://github.com/Gaepo-transcendance-fighters/ft_memo/assets/85930183/e84f6802-085f-431d-b22c-ab2fab97f4a3" width="90%">

<br>

---

## 1-5. Implementation details

"Room" ê¸°ëŠ¥ì€ Adapter ë¼ê³  í•˜ëŠ” ê²ƒìœ¼ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤. ì´ ì–´ëŒ‘í„°ëŠ” ì„œë²„ ì¸¡ ì»´í¬ë„ŒíŠ¸ë¡œ, ë‹¤ìŒì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

-   ì†Œì¼“ ì¸ìŠ¤í„´ìŠ¤ì™€ room ê°„ì˜ ê´€ê³„ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

-   ëª¨ë“ (ë˜ëŠ” ì¼ë¶€) í´ë¼ì´ì–¸íŠ¸ì— ì´ë²¤íŠ¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•˜ê¸°

ê¸°ë³¸ ì¸ë©”ëª¨ë¦¬ ì–´ëŒ‘í„°ì˜ ì½”ë“œëŠ” [ì—¬ê¸°](https://github.com/socketio/socket.io-adapter)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ë‘ ê°œì˜ ES6 ë§µìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

-   `sids`: `Map<SocketId, Set<Room>>`

-   `rooms`: `Map<Room, Set<SocketId>>`

`socket.join("the-room")` ì„ í˜¸ì¶œí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

-   `sids Map` ì— ì†Œì¼“ IDë¡œ ì‹ë³„ë˜ëŠ” `Set` ì— `"the-room"` ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

-   `rooms Map` ì—ì„œ `"the-room"` ë¬¸ìì—´ë¡œ ì‹ë³„ë˜ëŠ” `Set`ì— `ì†Œì¼“ ID`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì´ ë‘ `Map` ì€ `broadcast` í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

-   ëª¨ë“  ì†Œì¼“ì— ëŒ€í•œ ë¸Œë¡œë“œìºìŠ¤íŠ¸(`io.emit()`)ëŠ” `sids Map`ì„ ë°˜ë³µí•˜ê³  ëª¨ë“  ì†Œì¼“ì— íŒ¨í‚·ì„ ë³´ëƒ…ë‹ˆë‹¤.

-   íŠ¹ì • ë°©ìœ¼ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸(`io.to("room21").emit()`)ëŠ” `rooms Map ì˜ Set`ì„ ë°˜ë³µí•˜ê³  ì¼ì¹˜í•˜ëŠ” ëª¨ë“  ì†Œì¼“ìœ¼ë¡œ íŒ¨í‚·ì„ ë³´ëƒ…ë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ ê°œì²´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
// main namespace
const rooms = io.of("/").adapter.rooms;
const sids = io.of("/").adapter.sids;

// custom namespace
const rooms = io.of("/my-namespace").adapter.rooms;
const sids = io.of("/my-namespace").adapter.sids;
```

â˜ğŸ» ì°¸ê³ 

-   ì´ëŸ¬í•œ ê°ì²´ëŠ” ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í•­ìƒ `socket.join(...)` ë° `socket.leave(...)`ë¥¼ ëŒ€ì‹  ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

-   [multi-server](https://socket.io/docs/v4/using-multiple-nodes/)ì—ì„œëŠ” `rooms` ì™€ sid`s ê°ì²´ë“¤ì´ Socket.IO ì„œë²„ ê°„ì— ê³µìœ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤(Room ì€ í•œ ì„œë²„ì—ë§Œ 'ì¡´ì¬'í•˜ê³  ë‹¤ë¥¸ ì„œë²„ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ).

<br>

---

## 1-5. Room events

`socket.io@3.1.0` ë¶€í„° ê¸°ë³¸ ì–´ëŒ‘í„°ëŠ” ë‹¤ìŒ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.

-   `create-room` (argument: room)
-   `delete-room` (argument: room)
-   `join-room` (argument: room, id)
-   `leave-room `(argument: room, id)

EX)

```ts
io.of("/").adapter.on("create-room", (room) => {
    console.log(`room ${room} was created`);
});

io.of("/").adapter.on("join-room", (room, id) => {
    console.log(`socket ${id} has joined room ${room}`);
});
```
