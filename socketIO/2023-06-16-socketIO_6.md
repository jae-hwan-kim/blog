---
title: "socketIO (6)"
categories:
    - socket
tags:
    - socketIO

last_modified_at: 2023-06-16T21:30:00
---

λ©”λ¨λ¦¬ μ‚¬μ©λ‰

[ν•΄μ„ νμ΄μ§€](https://socket.io/docs/v4/memory-usage/)

# 1. Memory usage

Socket.IO μ„λ²„κ°€ μ†λΉ„ν•λ” λ¦¬μ†μ¤λ” μ£Όλ΅ λ‹¤μμ— λ”°λΌ λ‹¬λΌμ§‘λ‹λ‹¤.

-   μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈ μ
-   μ΄λ‹Ή μμ‹  λ° μ „μ†΅λλ” λ©”μ‹μ§€ μ(κΈ°λ³Έ λ°μ‹ , μΉμΈκ³Ό ν•¨κ» λ°μ‹  λ° λΈλ΅λ“μΊμ¤νΈ)

---

# 1-1. Memory usage per WebSocket server implementation

Socket.IO μ„λ²„μ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ€ κΈ°λ³Έ μ›Ήμ†μΌ“ μ„λ²„ κµ¬ν„μ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ— λ”°λΌ ν¬κ² λ‹¬λΌμ§‘λ‹λ‹¤. μ•„λ μ°¨νΈλ” 0μ—μ„ μµλ€ 10,000κ°μ μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈλ¥Ό κΈ°μ¤€μΌλ΅ Socket.IO μ„λ²„μ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ„ ν‘μ‹ν•©λ‹λ‹¤.

-   ws ν¨ν‚¤μ§€ κΈ°λ° Socket.IO μ„λ²„(κΈ°λ³Έκ°’μΌλ΅ μ‚¬μ©)
-   C++ μ›Ήμ†μΌ“ μ„λ²„ κµ¬ν„μΈ eiows ν¨ν‚¤μ§€λ¥Ό κΈ°λ°μΌλ΅ ν•λ” Socket.IO μ„λ²„(μ„¤μΉ λ‹¨κ³„ μ°Έμ΅°)
-   ΒµWebSockets.js ν¨ν‚¤μ§€λ¥Ό κΈ°λ°μΌλ΅ ν•λ” Socket.IO μ„λ²„, Node.js λ„¤μ΄ν‹°λΈ HTTP μ„λ²„μ C++ λ€μ•(μ„¤μΉ λ‹¨κ³„ μ°Έμ΅°)
-   ws ν¨ν‚¤μ§€λ¥Ό κΈ°λ°μΌλ΅ ν•λ” μΌλ° μ›Ήμ†μΌ“ μ„λ²„

<img src="https://github.com/Gaepo-transcendance-fighters/ft_transcendance/assets/85930183/db88dfc5-9422-4343-b678-f50cf955ddce" width="90%">

λ‹¤μ ν¨ν‚¤μ§€ λ²„μ „κ³Ό ν•¨κ» `μ°λ¶„ν¬ 20.04.5 LTS`μ™€ `Node.js v16.18.1`μ—μ„ ν…μ¤νΈλμ—μµλ‹λ‹¤:

-   socket.io@4.5.4
-   eiows@3.8.0
-   uWebSockets.js@20.4.0
-   ws@8.2.3

---

# 1-2. Memory usage over time

μ•„λ μ°¨νΈλ” 0μ—μ„ μµλ€ 10,000κ°μ μ—°κ²°λ ν΄λΌμ΄μ–ΈνΈκΉμ§€ μ‹κ°„ κ²½κ³Όμ— λ”°λ¥Έ Socket.IO μ„λ²„μ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ„ ν‘μ‹ν•©λ‹λ‹¤.

<img src="https://github.com/Gaepo-transcendance-fighters/ft_transcendance/assets/85930183/3d61b61d-9b09-4b1a-a5d1-722f26d73d05" width="90%">

βπ» λ°λ¨ λ©μ μΌλ΅ κ° ν΄λΌμ΄μ–ΈνΈ μ›¨μ΄λΈκ°€ λλ‚  λ•λ§λ‹¤ κ°€λΉ„μ§€ μμ§‘κΈ°λ¥Ό μλ™μΌλ΅ νΈμ¶ν•©λ‹λ‹¤.

```ts
io.on("connection", (socket) => {
    socket.on("disconnect", () => {
        const lastToDisconnect = io.of("/").sockets.size === 0;
        if (lastToDisconnect) {
            gc();
        }
    });
});
```
λ§μ§€λ§‰ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ λμ„ λ• λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ΄ κΉ”λ”ν•κ² μ¤„μ–΄λ“λ” κ²ƒμ„ μ„¤λ…ν•©λ‹λ‹¤. μ΄ κΈ°λ¥μ€ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ ν•„μ”ν•μ§€ μ•μΌλ©°, ν•„μ”ν•  λ• κ°€λΉ„μ§€ μ»¬λ ‰μ…μ΄ μλ™μΌλ΅ νΈλ¦¬κ±°λ©λ‹λ‹¤.