---
title: "[DOCS] socketIO ê³µì‹ë¬¸ì„œ (23)"
categories:
    - socket
tags:
    - socketIO

last_modified_at: 2023-06-23T15:30:00
---

[Emitting events](https://socket.io/docs/v4/emitting-events/) í˜ì´ì§€ í•´ì„

# 1. Emitting events

ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì— ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ëŠ” ë°©ë²•ì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

ğŸ’¡ TIP : TypeScript ì‚¬ìš©ìì˜ ê²½ìš° ì´ë²¤íŠ¸ì— ëŒ€í•œ ìœ í˜• íŒíŠ¸ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [ì—¬ê¸°](https://socket.io/docs/v4/typescript/)ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.

<br>

---

## 1-1. Basic emit

Socket.IO APIëŠ” Node.js [EventEmitter](https://nodejs.org/docs/latest/api/events.html#events_events) ì—ì„œ ì˜ê°ì„ ì–»ì€ ê²ƒìœ¼ë¡œ, í•œ ìª½ì—ì„œëŠ” ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•˜ê³  ë‹¤ë¥¸ ìª½ì—ì„œëŠ” ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

-   Server

    ```ts
    io.on("connection", (socket) => {
        socket.emit("hello", "world");
    });
    ```

-   Client

    ```ts
    socket.on("hello", (arg) => {
        console.log(arg); // world
    });
    ```

ì´ëŠ” ë‹¤ë¥¸ ë°©í–¥ì—ì„œë„ ì‘ë™í•©ë‹ˆë‹¤.

-   Server

    ```ts
    io.on("connection", (socket) => {
        socket.on("hello", (arg) => {
            console.log(arg); // world
        });
    });
    ```

-   Client

    ```ts
    socket.emit("hello", "world");
    ```

ì¸ìˆ˜ëŠ” ì–¼ë§ˆë“ ì§€ ë³´ë‚¼ ìˆ˜ ìˆìœ¼ë©°, [Buffer](https://nodejs.org/docs/latest/api/buffer.html#buffer_buffer) ë‚˜ [TypedArray](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray) ì™€ ê°™ì€ ë°”ì´ë„ˆë¦¬ ê°ì²´ë¥¼ í¬í•¨í•˜ì—¬ ì§ë ¬í™” ê°€ëŠ¥í•œ ëª¨ë“  ë°ì´í„° êµ¬ì¡°ê°€ ì§€ì›ë©ë‹ˆë‹¤.

-   Server

    ```ts
    io.on("connection", (socket) => {
        socket.emit("hello", 1, "2", { 3: "4", 5: Buffer.from([6]) });
    });
    ```

-   Client

    ```ts
    // client-side
    socket.on("hello", (arg1, arg2, arg3) => {
        console.log(arg1); // 1
        console.log(arg2); // "2"
        console.log(arg3); // { 3: '4', 5: ArrayBuffer (1) [ 6 ] }
    });
    ```

â­ï¸ ê°ì²´ì—ì„œ `JSON.stringify()` ë¥¼ ì‹¤í–‰í•  í•„ìš” ì—†ì´ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

```ts
// BAD
socket.emit("hello", JSON.stringify({ name: "John" }));

// GOOD
socket.emit("hello", { name: "John" });
```

â˜ğŸ» ì°¸ê³ 

-   [Date](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date) ê°œì²´ëŠ” í•´ë‹¹ ë¬¸ìì—´ í‘œí˜„(ì˜ˆ: `1970-01-01T00:00:00:00.000Z`)ìœ¼ë¡œ ë³€í™˜ë˜ì–´ ìˆ˜ì‹ ë©ë‹ˆë‹¤.

-   [Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map) ê³¼ [Set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set) ëŠ” ìˆ˜ë™ìœ¼ë¡œ ì§ë ¬í™”í•´ì•¼ í•©ë‹ˆë‹¤.

    ```ts
    const serializedMap = [...myMap.entries()];
    const serializedSet = [...mySet.keys()];
    ```

-   [`toJSON()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#tojson_behavior)ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì²´ì˜ ì§ë ¬í™”ë¥¼ ì‚¬ìš©ì ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

EX)

```ts
class Hero {
    #hp;

    constructor() {
        this.#hp = 42;
    }

    toJSON() {
        return { hp: this.#hp };
    }
}

socket.emit("here's a hero", new Hero());
```

`Hero` í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ "here's a hero" ì´ë²¤íŠ¸ë¥¼ ë‚´ë³´ë‚´ë©´, ë‚´ë³´ë‚¸ ë°ì´í„°ëŠ” JSONì„ ì‚¬ìš©í•˜ì—¬ ì§ë ¬í™”ë©ë‹ˆë‹¤. ì´ ê²½ìš° `Hero` í´ë˜ìŠ¤ì—ëŠ” `hp` ì†ì„±ì„ ê°€ì§„ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” `toJSON()` ë©”ì„œë“œê°€ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë°©ì¶œëœ ë°ì´í„°ëŠ” `hp ì†ì„±ì´ 42ë¡œ ì„¤ì •ëœ ê°ì²´`ê°€ ë©ë‹ˆë‹¤.

```json
{
    "hp": 42
}
```

<br>

---

## 1-2. Acknowledgements

ì´ë²¤íŠ¸ë„ ì¢‹ì§€ë§Œ, ê²½ìš°ì— ë”°ë¼ì„œëŠ” ì¢€ ë” ê³ ì „ì ì¸ ìš”ì²­-ì‘ë‹µ APIê°€ í•„ìš”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. Socket.IOì—ì„œëŠ” ì´ ê¸°ëŠ¥ì„ ìŠ¹ì¸ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

`emit()`ì˜ ë§ˆì§€ë§‰ ì¸ìˆ˜ë¡œ ì½œë°±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìœ¼ë©°, ìƒëŒ€ë°©ì´ ì´ë²¤íŠ¸ë¥¼ ìŠ¹ì¸í•˜ë©´ ì´ ì½œë°±ì´ í˜¸ì¶œë©ë‹ˆë‹¤.

-   Server

    ```ts
    io.on("connection", (socket) => {
        socket.on("update item", (arg1, arg2, callback) => {
            console.log(arg1); // 1
            console.log(arg2); // { name: "updated" }
            callback({
                status: "ok",
            });
        });
    });
    ```

-   Client

    ```ts
    socket.emit("update item", "1", { name: "updated" }, (response) => {
        console.log(response.status); // ok
    });
    ```

<br>

---

## 1-3. With timeout

Socket.IO v4.4.0ë¶€í„°ëŠ” ì´ì œ ê° ë°©ì¶œì— íƒ€ì„ì•„ì›ƒì„ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
socket.timeout(5000).emit("my-event", (err) => {
    if (err) {
        // the other side did not acknowledge the event in the given delay
    }
});
```

íƒ€ì„ì•„ì›ƒê³¼ [ìŠ¹ì¸](https://socket.io/docs/v4/emitting-events/#acknowledgements)ì„ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```ts
socket.timeout(5000).emit("my-event", (err, response) => {
    if (err) {
        // the other side did not acknowledge the event in the given delay
    } else {
        console.log(response);
    }
});
```

<br>

---

## 1-3. Volatile events

íœ˜ë°œì„± ì´ë²¤íŠ¸ëŠ” ê¸°ë³¸ ì—°ê²°ì´ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš° ì „ì†¡ë˜ì§€ ì•ŠëŠ” ì´ë²¤íŠ¸ì…ë‹ˆë‹¤(ì•ˆì •ì„± ì¸¡ë©´ì—ì„œ [UDP](https://fr.wikipedia.org/wiki/User_Datagram_Protocol)ì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤).

ì˜ˆë¥¼ ë“¤ì–´ ì˜¨ë¼ì¸ ê²Œì„ì—ì„œ ìºë¦­í„°ì˜ ìœ„ì¹˜ë¥¼ ì „ì†¡í•´ì•¼ í•˜ëŠ” ê²½ìš° ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
socket.volatile.emit("hello", "might or might not be received");
```

ë˜ ë‹¤ë¥¸ ì‚¬ìš© ì‚¬ë¡€ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ë˜ì§€ ì•Šì€ ê²½ìš° ì´ë²¤íŠ¸ë¥¼ ì‚­ì œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤(ê¸°ë³¸ì ìœ¼ë¡œ ì´ë²¤íŠ¸ëŠ” ì¬ì—°ê²°ë  ë•Œê¹Œì§€ ë²„í¼ë§ë©ë‹ˆë‹¤).

EX)

-   Server

    ```ts
    io.on("connection", (socket) => {
        console.log("connect");

        socket.on("ping", (count) => {
            console.log(count);
        });
    });
    ```

-   Server

    ```ts
    let count = 0;
    setInterval(() => {
        socket.volatile.emit("ping", ++count);
    }, 1000);
    ```

ì„œë²„ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ì½˜ì†”ì— í‘œì‹œë©ë‹ˆë‹¤.

```ts
connect
1
2
3
4
# the server is restarted, the client automatically reconnects
connect
9
10
11
```

`volatile` í”Œë˜ê·¸ê°€ ì—†ìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```ts
connect
1
2
3
4
# the server is restarted, the client automatically reconnects and sends its buffered events
connect
5
6
7
8
9
10
11
```
