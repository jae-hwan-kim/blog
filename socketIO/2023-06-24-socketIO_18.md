---
title: "[DOCS] socketIO ê³µì‹ë¬¸ì„œ (20)"
categories:
    - socket
tags:
    - socketIO

last_modified_at: 2023-06-23T14:32:00
---

[The Socket instance (client-side)](https://socket.io/docs/v4/client-socket-instance/) í˜ì´ì§€ í•´ì„

# The Socket instance (client-side)

ì†Œì¼“ì€ ì„œë²„ì™€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•œ ê¸°ë³¸ í´ë˜ìŠ¤ì…ë‹ˆë‹¤. ì´ í´ë˜ìŠ¤ëŠ” [emit](https://socket.io/docs/v4/client-api/#socketemiteventname-args), [on](https://socket.io/docs/v4/client-api/#socketoneventname-callback), [once](https://socket.io/docs/v4/client-api/#socketonceeventname-callback) ë˜ëŠ” [off](https://socket.io/docs/v4/client-api/#socketoffeventname)ì™€ ê°™ì€ Node.js [EventEmitter](https://nodejs.org/api/events.html#class-eventemitter)ì˜ ë©”ì„œë“œ ëŒ€ë¶€ë¶„ì„ ìƒì†ë°›ìŠµë‹ˆë‹¤.

<img src="https://github.com/Gaepo-transcendance-fighters/ft_transcendance/assets/85930183/9e45bc5f-f40f-4474-a63e-d602abd9b747" width="90%">

[emitting](https://socket.io/docs/v4/emitting-events/#basic-emit) ì™€ [listening to](https://socket.io/docs/v4/listening-to-events/) events ì™¸ì—ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ì†ì„±ì´ ìˆìŠµë‹ˆë‹¤:

<br>

---

## 1-1. Socket#id

ìƒˆ ì—°ê²°ì—ëŠ” 20ìì˜ ì„ì˜ ì‹ë³„ìê°€ ê°ê° í• ë‹¹ë©ë‹ˆë‹¤. ì´ ì‹ë³„ìëŠ” ì„œë²„ ì¸¡ì˜ ê°’ê³¼ ë™ê¸°í™”ë©ë‹ˆë‹¤.

```ts
// server-side
io.on("connection", (socket) => {
    console.log(socket.id); // x8WIv7-mJelg7on_ALbx
});

// client-side
socket.on("connect", () => {
    console.log(socket.id); // x8WIv7-mJelg7on_ALbx
});

socket.on("disconnect", () => {
    console.log(socket.id); // undefined
});
```

â—ï¸ ì—°ê²° ìƒíƒœ ë³µêµ¬ê°€ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°, ID ì†ì„±ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ”(ë˜ëŠ” ë””ë²„ê¹… ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”) ì„ì‹œ IDì´ë¯€ë¡œ ì£¼ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

-   IDëŠ” ì›¹ì†Œì¼“ ì—°ê²°ì´ ëŠì–´ì§€ê±°ë‚˜ ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê³ ì¹  ë•Œì™€ ê°™ì´ ì¬ì—°ê²°í•  ë•Œë§ˆë‹¤ ë‹¤ì‹œ ìƒì„±ë©ë‹ˆë‹¤.

-   ë‘ ê°œì˜ ë‹¤ë¥¸ ë¸Œë¼ìš°ì € íƒ­ì—ëŠ” ë‘ ê°œì˜ ë‹¤ë¥¸ IDê°€ ìˆìŠµë‹ˆë‹¤.

-   ì„œë²„ì— ì§€ì •ëœ IDì— ëŒ€í•´ ì €ì¥ëœ ë©”ì‹œì§€ íê°€ ì—†ëŠ” ê²½ìš°(ì¦‰, í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì´ ëŠì–´ì§€ë©´ ì„œë²„ì—ì„œ ì´ IDë¡œ ì „ì†¡ëœ ë©”ì‹œì§€ê°€ ì†ì‹¤ë¨)

ëŒ€ì‹  ì¼ë°˜ ì„¸ì…˜ IDë¥¼ ì‚¬ìš©í•˜ì„¸ìš”(ì¿ í‚¤ë¡œ ì „ì†¡ë˜ê±°ë‚˜ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥ë˜ì–´ [auth](https://socket.io/docs/v4/client-options/#auth) í˜ì´ë¡œë“œì— ì „ì†¡ë¨).

ì°¸ê³ :

-   [ë¹„ê³µê°œ ë©”ì‹œì§€ ê°€ì´ë“œ 2ë¶€](https://socket.io/get-started/private-messaging-part-2/)
-   [ì¿ í‚¤ ì²˜ë¦¬ ë°©ë²•](https://socket.io/how-to/deal-with-cookies)

<br>

---

## 1-2. Socket#connected

ì´ ì†ì„±ì€ ì†Œì¼“ì´ í˜„ì¬ ì„œë²„ì— ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

```ts
socket.on("connect", () => {
    console.log(socket.connected); // true
});

socket.on("disconnect", () => {
    console.log(socket.connected); // false
});
```

<br>

---

## 1-3. Socket#io

[Manager](https://socket.io/docs/v4/client-api/#manager)ì— ëŒ€í•œ ì°¸ì¡°ì…ë‹ˆë‹¤.

```ts
socket.on("connect", () => {
    const engine = socket.io.engine;
    console.log(engine.transport.name); // in most cases, prints "polling"

    engine.once("upgrade", () => {
        // called when the transport is upgraded (i.e. from HTTP long-polling to WebSocket)
        console.log(engine.transport.name); // in most cases, prints "websocket"
    });

    engine.on("packet", ({ type, data }) => {
        // called for each packet received
    });

    engine.on("packetCreate", ({ type, data }) => {
        // called for each packet sent
    });

    engine.on("drain", () => {
        // called when the write buffer is drained
    });

    engine.on("close", (reason) => {
        // called when the underlying connection is closed
    });
});
```

<br>

---

## 1-4. Lifecycle

<img src="https://github.com/Gaepo-transcendance-fighters/ft_memo/assets/85930183/17febd9d-9b4d-4274-b2f2-a60476297566" width="90%">

<br>

---

## 1-5. Events

ì†Œì¼“ ì¸ìŠ¤í„´ìŠ¤ëŠ” ì„¸ ê°€ì§€ íŠ¹ë³„í•œ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.

-   [connect](https://socket.io/docs/v4/client-socket-instance/#connect)
-   [connect_error](https://socket.io/docs/v4/client-socket-instance/#connect-error)
-   [disconnect](https://socket.io/docs/v4/client-socket-instance/#disconnect)

Socket.IO v3ë¶€í„° Socket ì¸ìŠ¤í„´ìŠ¤ëŠ” ë” ì´ìƒ ì¬ì—°ê²° ë¡œì§ê³¼ ê´€ë ¨ëœ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠìŠµë‹ˆë‹¤. Manager ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì§ì ‘ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
socket.io.on("reconnect_attempt", () => {
    // ...
});

socket.io.on("reconnect", () => {
    // ...
});
```

ìì„¸í•œ ë‚´ìš©ì€ [migration guide](https://socket.io/docs/v4/migrating-from-2-x-to-3-0/#the-socket-instance-will-no-longer-forward-the-events-emitted-by-its-manager) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

### â†˜ï¸ `connect`

ì´ ì´ë²¤íŠ¸ëŠ” ì—°ê²° ë° ì¬ì—°ê²° ì‹œ ì†Œì¼“ ì¸ìŠ¤í„´ìŠ¤ì— ì˜í•´ ë°œìƒí•©ë‹ˆë‹¤.

```ts
socket.on("connect", () => {
    // ...
});
```

ì†Œì¼“ì´ ë‹¤ì‹œ ì—°ê²°ë  ë•Œë§ˆë‹¤ ìƒˆ í•¸ë“¤ëŸ¬ê°€ ë“±ë¡ë˜ë¯€ë¡œ ì—°ê²° í•¸ë“¤ëŸ¬ ìì²´ì— ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.

```ts
// BAD
socket.on("connect", () => {
    socket.on("data", () => {
        /* ... */
    });
});

// GOOD
socket.on("connect", () => {
    // ...
});

socket.on("data", () => {
    /* ... */
});
```

<br>

### â†˜ï¸ `connect_error`

ì´ ì´ë²¤íŠ¸ëŠ” ë‹¤ìŒ ìƒí™©ì— ë°œìƒí•©ë‹ˆë‹¤.

-   low-level ì—°ê²°ì„ ì„¤ì •í•  ìˆ˜ ì—†ëŠ” ê²½ìš°
-   [ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜](https://socket.io/docs/v4/middlewares/)ì—ì„œ ì„œë²„ì— ì˜í•´ ì—°ê²°ì´ ê±°ë¶€ëœ ê²½ìš°

ì²« ë²ˆì§¸ ê²½ìš°, ì†Œì¼“ì€ [ì¼ì • ì‹œê°„ ì§€ì—°](https://socket.io/docs/v4/client-options/#reconnectiondelay) í›„ ìë™ìœ¼ë¡œ ì¬ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤.

í›„ìì˜ ê²½ìš°ì—ëŠ” ìˆ˜ë™ìœ¼ë¡œ ë‹¤ì‹œ ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤. ìê²© ì¦ëª…ì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```ts
// either by directly modifying the `auth` attribute
socket.on("connect_error", () => {
    socket.auth.token = "abcd";
    socket.connect();
});

// or if the `auth` attribute is a function
const socket = io({
    auth: (cb) => {
        cb(localStorage.getItem("token"));
    },
});

socket.on("connect_error", () => {
    setTimeout(() => {
        socket.connect();
    }, 1000);
});
```

<br>

### â†˜ï¸ `disconnect`

ì´ ì´ë²¤íŠ¸ëŠ” ì—°ê²°ì´ ëŠì–´ì§€ë©´ ë°œìƒí•©ë‹ˆë‹¤.

```ts
socket.on("disconnect", (reason) => {
    // ...
});
```

ëŠê¸°ëŠ” ìƒí™©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

-   `io server disconnect`

    -   ì„œë²„ê°€ [`socket.disconnect()`](https://socket.io/docs/v4/server-api/#socketdisconnectclose)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì†Œì¼“ì„ ê°•ì œë¡œ ì—°ê²° í•´ì œí–ˆì„ ë•Œ

      <br>

-   `io client disconnect`

    -   ì†Œì¼“ì€ [socket.disconnect()](https://socket.io/docs/v4/client-api/#socketdisconnect)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ë™ìœ¼ë¡œ ì—°ê²° í•´ì œí–ˆì„ ë•Œ

      <br>

-   `ping timeout`

    -   ì„œë²„ê°€ `pingInterval` + `pingTimeout` ë²”ìœ„ ë‚´ì—ì„œ `PING`ì„ ë³´ë‚´ì§€ ì•Šì•˜ì„ ë•Œ

      <br>

-   `transport close`

    -   ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆì„ ë•Œ (ì˜ˆ: ì‚¬ìš©ìê°€ ì—°ê²°ì„ ëŠì—ˆê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ê°€ WiFiì—ì„œ 4Gë¡œ ë³€ê²½ë¨).

      <br>

-   `transport error`

    -   ì—°ê²°ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ (ì˜ˆ: HTTP ê¸´ í´ë§ ì£¼ê¸° ë™ì•ˆ ì„œë²„ê°€ ì¢…ë£Œë¨).

      <br>

ì²˜ìŒ ë‘ ê²½ìš°(ëª…ì‹œì  ì—°ê²° ëŠê¹€)ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì¬ì—°ê²°ì„ ì‹œë„í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ `socket.connect()`ë¥¼ ìˆ˜ë™ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ë¥¸ ëª¨ë“  ê²½ìš°ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì•½ê°„ì˜ [`ë¬´ì‘ìœ„ ì§€ì—°`](https://socket.io/docs/v4/client-options/#reconnectiondelay)ì„ ê¸°ë‹¤ë¦° í›„ ë‹¤ì‹œ ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤:

```ts
socket.on("disconnect", (reason) => {
    if (reason === "io server disconnect") {
        // the disconnection was initiated by the server, you need to reconnect manually
        socket.connect();
    }
    // else the socket will automatically try to reconnect
});
```

â˜ğŸ» ì°¸ê³ : ì´ëŸ¬í•œ ì´ë²¤íŠ¸ëŠ” `disconnecting`, `newListener` ë° `removeListener`ì™€ í•¨ê»˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•´ì„œëŠ” ì•ˆ ë˜ëŠ” íŠ¹ìˆ˜ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤:

```ts
// BAD, will throw an error
socket.emit("disconnect");
```

<br>

---

## 1-6. Complete API

ì†Œì¼“ ì¸ìŠ¤í„´ìŠ¤ì˜ ì „ì²´ APIëŠ” [ì—¬ê¸°](https://socket.io/docs/v4/client-api/#socket)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
