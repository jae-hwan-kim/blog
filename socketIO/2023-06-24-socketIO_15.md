---
title: "[DOCS] socketIO ê³µì‹ë¬¸ì„œ (17)"
categories:
    - socket
tags:
    - socketIO

last_modified_at: 2023-06-23T13:42:00
---

[Usage with bundlers](https://socket.io/docs/v4/server-with-bundlers/) í˜ì´ì§€ í•´ì„

# 1. Usage with bundlers

í”„ë¡ íŠ¸ì—”ë“œ ë²ˆë“¤ë§ë³´ë‹¤ëŠ” ëœ ì¼ë°˜ì ì´ì§€ë§Œ ì„œë²„ìš© ë²ˆë“¤ì„ ìƒì„±í•˜ëŠ” ê²ƒì€ ì¶©ë¶„íˆ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## 1-1. Webpack 5

### â†˜ï¸ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ ì—†ì´

-   ì„¤ì¹˜

    ```sh
    npm install -D webpack webpack-cli socket.io bufferutil utf-8-validate
    ```

-   `index.js`

    ```ts
    const { Server } = require("socket.io");

    const io = new Server({
        serveClient: false,
    });

    io.on("connection", (socket) => {
        console.log(`connect ${socket.id}`);

        socket.on("disconnect", (reason) => {
            console.log(`disconnect ${socket.id} due to ${reason}`);
        });
    });

    io.listen(3000);
    ```

-   `webpack.config.js`

    ```ts
    const path = require("path");

    module.exports = {
        entry: "./index.js",
        target: "node",
        mode: "production",
        output: {
            path: path.resolve(__dirname, "dist"),
            filename: "index.js",
        },
    };
    ```

â˜ğŸ» ì°¸ê³ : `bufferutil`ê³¼ `utf-8-validate`ëŠ” `ws` íŒ¨í‚¤ì§€ì˜ ë‘ ê°€ì§€ ì„ íƒì  ì¢…ì†ì„±ì…ë‹ˆë‹¤. ì´ë“¤ì„ "ì™¸ë¶€"ë¡œ ì„¤ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```ts
const path = require("path");

module.exports = {
    entry: "./index.js",
    target: "node",
    mode: "production",
    output: {
        path: path.resolve(__dirname, "dist"),
        filename: "index.js",
    },
    externals: {
        bufferutil: "bufferutil",
        "utf-8-validate": "utf-8-validate",
    },
};
```

â˜ğŸ» ë¬¸ì„œ: https://webpack.js.org/configuration/externals/

<br>

### â†˜ï¸ í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ ìˆì´

ì´ ê²½ìš° [`Asset modules`](https://webpack.js.org/guides/asset-modules/)ì„ ì‚¬ìš©í•˜ê³  `Socket.IO` ì„œë²„ì˜ `sendFile` í•¨ìˆ˜ë¥¼ ì¬ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

-   `index.js`

    ```ts
    const { Server } = require("socket.io");

    const clientFile = require("./node_modules/socket.io/client-dist/socket.io.min?raw");
    const clientMap = require("./node_modules/socket.io/client-dist/socket.io.min.js.map?raw");

    Server.sendFile = (filename, req, res) => {
        res.end(filename.endsWith(".map") ? clientMap : clientFile);
    };

    const io = new Server();

    io.on("connection", (socket) => {
        console.log(`connect ${socket.id}`);

        socket.on("disconnect", (reason) => {
            console.log(`disconnect ${socket.id} due to ${reason}`);
        });
    });

    io.listen(3000);
    ```

-   `webpack.config.js`

    ```ts
    const path = require("path");

    module.exports = {
        entry: "./index.js",
        target: "node",
        mode: "production",
        output: {
            path: path.resolve(__dirname, "dist"),
            filename: "index.js",
        },
        module: {
            rules: [
                {
                    resourceQuery: /raw/,
                    type: "asset/source",
                },
            ],
        },
    };
    ```
